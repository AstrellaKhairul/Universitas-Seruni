

<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Peta Interaktif Kampus — Universitas Seruni</title>
  <meta name="description" content="Peta interaktif kampus Universitas Seruni — modern, minimalis, profesional. Menampilkan Kampus Utama, Kampus Kesehatan, Kampus Selatan, dan Kampus Vokasi. Shuttle antar-kampus menuju Kampus Utama."/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    /*
      Universitas Seruni — Peta Interaktif

    */

    :root{
      --bg: #f5f7fb;
      --card: #ffffff;
      --muted: #6b7280;
      --text: #0b1220;
      --accent: #0f4c81;       /* utama */
      --accent-2: #0fb1a9;     /* sekunder */
      --glass: rgba(255,255,255,0.8);
      --shadow: 0 8px 30px rgba(15,23,42,0.06);
      --radius: 12px;
      --map-gradient: linear-gradient(180deg,#f8fbff 0%, #ffffff 100%);
      --line: rgba(15,23,42,0.06);
    }

    /* Reset */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, ui-sans-serif, system-ui, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.4;
      padding-bottom:48px;
    }

    /* Page container */
    .wrap{
      max-width:1280px;
      margin:28px auto;
      padding:20px;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:20px;
      margin-bottom:18px;
    }

    .brand{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .logo{
      width:56px;
      height:56px;
      border-radius:10px;
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(135deg,#eff6ff,#e6f7f5);
      box-shadow: 0 6px 18px rgba(15,23,42,0.04);
      border:1px solid rgba(15,23,42,0.03);
      font-weight:700;
      color:var(--accent);
      font-size:18px;
    }
    header h1{
      margin:0;
      font-size:18px;
      letter-spacing:-0.2px;
      color:var(--accent);
      font-weight:700;
    }
    header p{
      margin:0;
      color:var(--muted);
      font-size:13px;
    }

    .controls-top{
      display:flex;
      gap:8px;
      align-items:center;
    }

    /* Card layout */
    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
      border:1px solid var(--line);
    }

    .layout{
      display:grid;
      grid-template-columns:1fr 360px;
      gap:20px;
      align-items:start;
    }

    @media (max-width:980px){
      .layout{grid-template-columns:1fr}
    }

    /* Map area */
    .map-wrap{
      border-radius:14px;
      overflow:hidden;
      position:relative;
      min-height:640px;
      background:var(--map-gradient);
      display:flex;
      flex-direction:column;
      gap:12px;
      padding:18px;
    }

    /* Top map info */
    .map-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .map-title{
      display:flex;
      flex-direction:column;
    }
    .map-title h2{margin:0;font-size:16px;color:var(--text);font-weight:700}
    .map-title p{margin:0;color:var(--muted);font-size:13px}

    .map-actions{display:flex;gap:8px;align-items:center}

    .btn{
      border:0;
      padding:8px 12px;
      border-radius:10px;
      background:var(--accent);
      color:white;
      font-weight:600;
      cursor:pointer;
      font-size:13px;
      box-shadow:0 6px 18px rgba(15,23,42,0.04);
    }
    .btn.ghost{
      background:transparent;
      color:var(--accent);
      border:1px solid rgba(15,23,42,0.06);
      box-shadow:none;
    }
    .btn.icon{
      padding:8px;
      width:40px;
      height:40px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border-radius:10px;
      background:transparent;
      border:1px solid rgba(15,23,42,0.04);
    }

    /* Map canvas */
    .map-canvas{
      flex:1;
      border-radius:10px;
      overflow:hidden;
      display:block;
      width:100%;
      height:100%;
      min-height:420px;
      background:transparent;
      position:relative;
    }

    /* Side panel */
    aside.side{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .campus-list{display:flex;flex-direction:column;gap:8px}
    .campus-item{
      display:flex;
      gap:12px;
      align-items:center;
      padding:10px;
      border-radius:10px;
      cursor:pointer;
      transition:all .12s ease;
      border:1px solid transparent;
    }
    .campus-item:hover{background:#f3f6ff; transform:translateY(-2px)}
    .campus-dot{
      width:12px;height:12px;border-radius:50%;
      background:var(--accent);
      flex:0 0 12px;
    }
    .campus-title{font-weight:700}
    .campus-sub{font-size:13px;color:var(--muted)}

    .legend{display:flex;flex-direction:column;gap:8px}
    .legend-row{display:flex;gap:10px;align-items:center}
    .legend-swatch{width:14px;height:14px;border-radius:4px}

    .info-block{font-size:13px;color:var(--muted)}

    /* Floating info panel on map */
    .panel{
      position:absolute;
      right:20px;
      top:20px;
      width:320px;
      max-width:calc(100% - 40px);
      z-index:60;
      transition:opacity .18s ease, transform .18s ease;
    }
    .panel.hidden{opacity:0;pointer-events:none;transform:translateY(-6px)}
    .panel .card{padding:12px}

    .panel h3{margin:0 0 4px 0;font-size:15px;color:var(--accent)}
    .panel .muted{color:var(--muted);font-size:13px}

    .panel .meta{display:flex;justify-content:space-between;gap:12px;align-items:center;margin-top:10px}

    /* Route styling */
    .route{
      stroke:var(--accent-2);
      stroke-width:3;
      fill:none;
      stroke-linecap:round;
      stroke-linejoin:round;
      opacity:0.95;
      filter: drop-shadow(0 6px 18px rgba(15,23,42,0.06));
    }
    .route.hidden{display:none}

    .shuttle{
      fill:var(--accent);
      stroke:#ffffff;
      stroke-width:1.5;
      r:8px;
      filter: drop-shadow(0 6px 18px rgba(15,23,42,0.08));
    }

    /* small utilities */
    .muted{color:var(--muted)}
    .small{font-size:12px}
    .row{display:flex;gap:8px;align-items:center}

    footer{
      text-align:center;
      color:var(--muted);
      font-size:13px;
      margin-top:20px;
    }

    /* Accessibility focus */
    .campus-item:focus{outline:3px solid rgba(15,76,129,0.12); border-radius:10px}
    button:focus{outline:3px solid rgba(15,76,129,0.12);}

    /* Responsive tweaks */
    @media (max-width:480px){
      header h1{font-size:16px}
      .map-header{flex-direction:column;align-items:flex-start;gap:8px}
      .panel{right:10px;left:10px;top:auto;bottom:12px}
    }

  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">US</div>
        <div>
          <h1>Universitas Seruni — Peta Interaktif Kampus</h1>
        </div>
      </div>

      <div class="controls-top">
        <button class="btn ghost" id="btnHelp" title="Petunjuk singkat">?</button>
        <button class="btn" id="btnExport" title="Export PNG">Export PNG</button>
      </div>
    </header>

    <main class="layout">
      <!-- MAP COLUMN -->
      <section>
        <div class="map-wrap card" role="region" aria-label="Peta Kampus Universitas Seruni">
          <div class="map-header">
            <div class="map-title">
              <h2>Peta Kampus — Fokus pada konektivitas ke Kampus Utama</h2>
            </div>
            <div class="map-actions">
              <button class="btn ghost" id="toggleRoutes" title="Tampilkan / Sembunyikan Rute">Rute</button>
              <button class="btn ghost" id="startShuttle" title="Mulai animasi shuttle">Mulai Shuttle</button>
              <button class="btn ghost" id="stopShuttle" title="Hentikan shuttle">Stop</button>
            </div>
          </div>

          <!-- SVG map: modern minimal shapes, no RIK -->
          <div class="map-canvas" id="mapCanvas">
            <svg id="svgMap" viewBox="0 0 1200 700" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" aria-hidden="false" role="img">
              <defs>
                <linearGradient id="bgGrad" x1="0" x2="0" y1="0" y2="1">
                  <stop offset="0%" stop-color="#f8fbff"/>
                  <stop offset="100%" stop-color="#ffffff"/>
                </linearGradient>

                <filter id="softShadow" x="-50%" y="-50%" width="200%" height="200%">
                  <feDropShadow dx="0" dy="8" stdDeviation="18" flood-color="#0b1220" flood-opacity="0.06"/>
                </filter>

                <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                  <feGaussianBlur stdDeviation="6" result="blur"/>
                  <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
                </filter>

                <symbol id="campusIcon" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="10" fill="white" stroke="currentColor" stroke-width="1.4"></circle>
                </symbol>

                <marker id="arrow" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
                  <path d="M 0 0 L 10 5 L 0 10 z" fill="#0fb1a9"></path>
                </marker>
              </defs>

              <!-- Background -->
              <rect width="1200" height="700" fill="url(#bgGrad)"></rect>

              <!-- Minimal soft landmasses / shapes for visual context (non-geographic) -->
              <g opacity="0.9" transform="translate(0,0)">
                <path d="M80 520 C220 460, 220 320, 420 300 C620 280, 740 180, 980 210 L1100 250 L1100 700 L0 700 L0 520 Z" fill="#f1f6ff" opacity="1"></path>
                <path d="M40 80 C160 40, 340 20, 560 40 C780 60, 980 120, 1140 160 L1140 0 L0 0 L0 80 Z" fill="#f9fff9" opacity="0.8"></path>
              </g>

              <!-- CAMPUS POSITIONS -->
              <!-- Kampus Utama (central hub) -->
              <g id="KampusUtama" class="campus" transform="translate(420,260)" data-x="420" data-y="260" aria-labelledby="labelUtama" role="button" tabindex="0" style="cursor:pointer">
                <circle cx="0" cy="0" r="48" fill="#ffffff" stroke="#0f4c81" stroke-width="3"></circle>
                <g transform="translate(-8,-8)" filter="url(#softShadow)">
                  <circle cx="0" cy="0" r="48" fill="transparent"></circle>
                </g>
                <text id="labelUtama" x="70" y="6" font-size="18" font-weight="700" fill="#0b1220">Kampus Utama</text>
                <text x="70" y="28" font-size="13" fill="#6b7280">Jakarta Selatan — Pusat akademik & administrasi</text>
              </g>

              <!-- Kampus Kesehatan -->
              <g id="KampusKesehatan" class="campus" transform="translate(700,110)" data-x="700" data-y="110" aria-labelledby="labelKes" role="button" tabindex="0" style="cursor:pointer">
                <rect x="-34" y="-34" width="68" height="68" rx="12" fill="#ffffff" stroke="#0f4c81" stroke-width="2.6"></rect>
                <text id="labelKes" x="44" y="6" font-size="16" font-weight="700" fill="#0b1220">Kampus Kesehatan</text>
                <text x="44" y="28" font-size="13" fill="#6b7280">Jakarta Pusat — Rumah sakit pendidikan & profesi</text>
              </g>

              <!-- Kampus Selatan -->
              <g id="KampusSelatan" class="campus" transform="translate(220,520)" data-x="220" data-y="520" aria-labelledby="labelSel" role="button" tabindex="0" style="cursor:pointer">
                <polygon points="-40,-36 38,18 -36,18" fill="#ffffff" stroke="#0f4c81" stroke-width="2.6" rx="6"></polygon>
                <text id="labelSel" x="60" y="6" font-size="16" font-weight="700" fill="#0b1220">Kampus Selatan</text>
                <text x="60" y="28" font-size="13" fill="#6b7280">Bogor Barat — Pertanian, kehutanan, seni</text>
              </g>

              <!-- Kampus Vokasi -->
              <g id="KampusVokasi" class="campus" transform="translate(980,380)" data-x="980" data-y="380" aria-labelledby="labelVok" role="button" tabindex="0" style="cursor:pointer">
                <ellipse cx="0" cy="0" rx="42" ry="26" fill="#ffffff" stroke="#0f4c81" stroke-width="2.6"></ellipse>
                <text id="labelVok" x="54" y="6" font-size="16" font-weight="700" fill="#0b1220">Kampus Vokasi</text>
                <text x="54" y="28" font-size="13" fill="#6b7280">Jakarta Timur — Pendidikan vokasi & teaching factory</text>
              </g>

              <!-- ROUTES: ALL POINT TO KAMPUS UTAMA -->
              <!-- Kesehatan -> Utama -->
              <path id="route_KK_U" d="M700,110 C620,140 540,170 480,210 440,235 430,250 420,260" class="route" stroke-linecap="round" marker-end="url(#arrow)"></path>

              <!-- Selatan -> Utama -->
              <path id="route_KS_U" d="M220,520 C300,420 360,340 420,280" class="route" stroke-linecap="round" marker-end="url(#arrow)"></path>

              <!-- Vokasi -> Utama -->
              <path id="route_KV_U" d="M980,380 C860,340 680,300 460,270 440,268 430,265 420,260" class="route" stroke-linecap="round" marker-end="url(#arrow)"></path>

              <!-- shuttle icon (single animated circle) -->
              <g id="shuttleLayer">
                <circle id="shuttle" class="shuttle" cx="700" cy="110" r="9" fill="#0f4c81" stroke="#ffffff" stroke-width="1.6"></circle>
              </g>

              <!-- subtle grid / guides (for style) -->
              <g opacity="0.06" stroke="#0b1220" stroke-width="1" fill="none">
                <line x1="60" x2="1140" y1="160" y2="160"></line>
                <line x1="60" x2="1140" y1="400" y2="400"></line>
              </g>

            </svg>
          </div>

          <!-- floating panel (hidden by default) -->
          <div class="panel hidden" id="infoPanel" aria-live="polite">
            <div class="card">
              <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
                <div>
                  <h3 id="panelTitle">Kampus</h3>
                  <div class="muted small" id="panelSub">Lokasi</div>
                </div>
                <div>
                  <span style="display:inline-block;background:#eef6ff;color:var(--accent);padding:6px 10px;border-radius:999px;font-weight:700;font-size:13px" id="panelBadge">Info</span>
                </div>
              </div>

              <hr style="border:none;border-top:1px solid #f3f6ff;margin:12px 0">

              <div id="panelBody" class="muted" style="font-size:14px">
                Deskripsi singkat kampus.
              </div>

              <div class="meta">
                <div>
                  <div class="muted small">Layanan Shuttle</div>
                  <div style="font-weight:700" id="panelShuttle">Ke Kampus Utama setiap 30 menit</div>
                </div>
                <div style="display:flex;gap:8px;align-items:center">
                  <button class="btn ghost" id="panelClose">Tutup</button>
                </div>
              </div>

            </div>
          </div>

        </div>
      </section>

      <!-- SIDE COLUMN -->
      <aside class="side">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <h3 style="margin:0">Daftar Kampus</h3>
              <p class="muted small" style="margin:6px 0 0 0">Klik untuk melihat detail & layanan transportasi</p>
            </div>
            <div style="font-size:12px;color:var(--muted)">Mode: Minimal</div>
          </div>

          <div style="margin-top:12px" class="campus-list" role="list">
            <div class="campus-item" data-id="KampusUtama" role="listitem" tabindex="0" aria-label="Kampus Utama">
              <div class="campus-dot" style="background:#0f4c81"></div>
              <div>
                <div class="campus-title">Kampus Utama</div>
                <div class="campus-sub">Jakarta Selatan — Pusat akademik & administrasi</div>
              </div>
            </div>

            <div class="campus-item" data-id="KampusKesehatan" role="listitem" tabindex="0" aria-label="Kampus Kesehatan">
              <div class="campus-dot" style="background:#0fb1a9"></div>
              <div>
                <div class="campus-title">Kampus Kesehatan</div>
                <div class="campus-sub">Jakarta Pusat — Rumah sakit pendidikan & profesi</div>
              </div>
            </div>

            <div class="campus-item" data-id="KampusSelatan" role="listitem" tabindex="0" aria-label="Kampus Selatan">
              <div class="campus-dot" style="background:#0f4c81"></div>
              <div>
                <div class="campus-title">Kampus Selatan</div>
                <div class="campus-sub">Bogor Barat — Pertanian, kehutanan, seni</div>
              </div>
            </div>

            <div class="campus-item" data-id="KampusVokasi" role="listitem" tabindex="0" aria-label="Kampus Vokasi">
              <div class="campus-dot" style="background:#0f4c81"></div>
              <div>
                <div class="campus-title">Kampus Vokasi</div>
                <div class="campus-sub">Jakarta Timur — Pendidikan vokasi & teaching factory</div>
              </div>
            </div>
          </div>

          <div style="margin-top:12px;border-top:1px solid #f3f6ff;padding-top:12px">
            <h4 style="margin:0">Legend</h4>
            <div class="legend" style="margin-top:8px">
              <div class="legend-row"><div class="legend-swatch" style="background:#0f4c81"></div><div class="muted">Kampus Utama / Kampus</div></div>
              <div class="legend-row"><div class="legend-swatch" style="background:#0fb1a9"></div><div class="muted">Rute Shuttle menuju Kampus Utama</div></div>
              <div class="legend-row"><div class="legend-swatch" style="background:#0f4c81;opacity:0.8"></div><div class="muted">Kampus Vokasi / Seluruh kampus</div></div>
            </div>
          </div>
        </div>

        <div class="card">
          <h4 style="margin:0">Informasi Shuttle</h4>
          <p class="muted small" style="margin-top:8px">Semua rute diatur agar menuju Kampus Utama — memudahkan integrasi perkuliahan & layanan administrasi. Frekuensi dan titik pemberhentian dapat disesuaikan.</p>

          <table style="width:100%;margin-top:10px;border-collapse:collapse;font-size:13px">
            <thead style="display:none"></thead>
            <tbody>
              <tr><td style="padding:8px;border-top:1px solid #f3f6ff">Kampus Kesehatan → Kampus Utama [PP]</td><td style="padding:8px;border-top:1px solid #f3f6ff">Setiap 30 menit</td></tr>
              <tr><td style="padding:8px;border-top:1px solid #f3f6ff">Kampus Selatan → Kampus Utama [PP]</td><td style="padding:8px;border-top:1px solid #f3f6ff">Setiap 45 menit (antar-kota)</td></tr>
              <tr><td style="padding:8px;border-top:1px solid #f3f6ff">Kampus Vokasi → Kampus Utama [PP] </td><td style="padding:8px;border-top:1px solid #f3f6ff">Setiap 30 menit</td></tr>
              <tr><td style="padding:8px;border-top:1px solid #f3f6ff">Shuttle internal (Kampus Utama/Selatan)</td><td style="padding:8px;border-top:1px solid #f3f6ff">Loop tiap 5-10 menit</td></tr>
            </tbody>
          </table>

          <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
            <button class="btn ghost" id="btnReset">Reset View</button>
            <button class="btn ghost" id="btnDownloadPDF">Export PDF (simple)</button>
          </div>
        </div>

        <div class="card">
          <h4 style="margin:0">Catatan</h4>
          <p class="muted small" style="margin-top:8px">Hari minggu layanan shuttle tidak tersedia.</p>
        </div>
      </aside>
    </main>

    <footer>
      © 2025 Universitas Seruni — Peta Interaktif Kampus. All rights reserved.
    </footer>
  </div>

  <script>
    // Data model (explicitly: no RIK anywhere)
    const campusData = {
      KampusUtama: {
        id: 'KampusUtama',
        title: 'Kampus Utama',
        sub: 'Jl. Semeru Raya No. 99, Jakarta Selatan',
        desc: 'Pusat akademik & administrasi Universitas Seruni. Tempat kegiatan utama, layanan administrasi, serta titik penghubung antar-kampus.',
        badge: 'Kampus Utama',
        coords: {x:420,y:260}
      },
      KampusKesehatan: {
        id: 'KampusKesehatan',
        title: 'Kampus Kesehatan',
        sub: 'Jl. Medika No. 139, Jakarta Pusat',
        desc: 'Fokus pada pendidikan profesi, riset klinis, dan rumah sakit pendidikan. Shuttle menuju Kampus Utama tersedia reguler.',
        badge: 'Kampus Kesehatan',
        coords: {x:700,y:110}
      },
      KampusSelatan: {
        id: 'KampusSelatan',
        title: 'Kampus Selatan',
        sub: 'Jl. Perjuangan Raya No. 39, Bogor Barat',
        desc: 'Kampus berbasis lahan untuk pertanian, kehutanan, dan seni. Shuttle antar-kota menuju Kampus Utama tersedia.',
        badge: 'Kampus Selatan',
        coords: {x:220,y:520}
      },
      KampusVokasi: {
        id: 'KampusVokasi',
        title: 'Kampus Vokasi',
        sub: 'Jl. Satria No. 13, Jakarta Timur',
        desc: 'Pusat pendidikan vokasi & teaching factory. Shuttle reguler menuju Kampus Utama untuk kegiatan akademik terintegrasi.',
        badge: 'Kampus Vokasi',
        coords: {x:980,y:380}
      }
    };

    // DOM refs
    const svg = document.getElementById('svgMap');
    const infoPanel = document.getElementById('infoPanel');
    const panelTitle = document.getElementById('panelTitle');
    const panelSub = document.getElementById('panelSub');
    const panelBody = document.getElementById('panelBody');
    const panelBadge = document.getElementById('panelBadge');
    const panelShuttle = document.getElementById('panelShuttle');
    const panelClose = document.getElementById('panelClose');
    const btnToggle = document.getElementById('toggleRoutes');
    const btnStartShuttle = document.getElementById('startShuttle');
    const btnStopShuttle = document.getElementById('stopShuttle');
    const shuttleEl = document.getElementById('shuttle');
    const routeKKU = document.getElementById('route_KK_U');
    const routeKSU = document.getElementById('route_KS_U');
    const routeKVU = document.getElementById('route_KV_U');

    // Utility: find element by campus id and attach events
    Object.keys(campusData).forEach(key => {
      const el = document.getElementById(key);
      if(!el) return;
      el.style.cursor = 'pointer';
      el.addEventListener('click', ()=> openPanel(key));
      el.addEventListener('keydown', (e)=> { if(e.key === 'Enter' || e.key === ' ') openPanel(key); });
    });

    // Side list click handlers
    document.querySelectorAll('.campus-item').forEach(it=>{
      it.addEventListener('click', ()=> openPanel(it.dataset.id));
      it.addEventListener('keydown', (e)=>{ if(e.key==='Enter') openPanel(it.dataset.id); });
    });

    function openPanel(id){
      const d = campusData[id];
      if(!d) return;
      panelTitle.textContent = d.title;
      panelSub.textContent = d.sub;
      panelBody.textContent = d.desc;
      panelBadge.textContent = d.badge;
      panelShuttle.textContent = 'Shuttle ke Kampus Utama setiap 30 menit';
      infoPanel.classList.remove('hidden');

      // compute top position for visual alignment
      const mapRect = document.getElementById('mapCanvas').getBoundingClientRect();
      const localY = Math.max(12, (d.coords.y / 700) * (mapRect.height - 40));
      infoPanel.style.top = (localY) + 'px';
    }

    panelClose.addEventListener('click', ()=> infoPanel.classList.add('hidden'));

    // Toggle routes visibility
    let routesVisible = true;
    btnToggle.addEventListener('click', ()=>{
      routesVisible = !routesVisible;
      [routeKKU, routeKSU, routeKVU].forEach(r => { if(r) r.style.display = routesVisible ? '' : 'none'; });
      btnToggle.textContent = routesVisible ? 'Sembunyikan Rute' : 'Tampilkan Rute';
    });

    // Shuttle animation along a chosen path in sequence
    const routes = [routeKKU, routeKSU, routeKVU].filter(Boolean);
    let animFrame = null;
    let animIndex = 0;
    let animProgress = 0;
    const speed = 0.0065; // tweak for comfortable speed

    function moveShuttleAlong(pathEl, progress){
      try{
        const len = pathEl.getTotalLength();
        const pt = pathEl.getPointAtLength(progress * len);
        shuttleEl.setAttribute('cx', pt.x);
        shuttleEl.setAttribute('cy', pt.y);
      }catch(e){
        // ignore invalid paths
      }
    }

    function animate(){
      if(!routes.length) return;
      const current = routes[animIndex % routes.length];
      moveShuttleAlong(current, animProgress);
      animProgress += speed;
      if(animProgress >= 1){
        animProgress = 0;
        animIndex = (animIndex + 1) % routes.length;
      }
      animFrame = requestAnimationFrame(animate);
    }

    btnStartShuttle.addEventListener('click', ()=>{
      if(animFrame) cancelAnimationFrame(animFrame);
      animFrame = requestAnimationFrame(animate);
    });

    btnStopShuttle.addEventListener('click', ()=>{
      if(animFrame) cancelAnimationFrame(animFrame);
      animFrame = null;
      // reset shuttle to default (Kampus Kesehatan start)
      shuttleEl.setAttribute('cx', campusData['KampusKesehatan'].coords.x);
      shuttleEl.setAttribute('cy', campusData['KampusKesehatan'].coords.y);
    });

    // Export PNG (SVG -> Canvas)
    document.getElementById('btnExport').addEventListener('click', ()=>{
      exportSVGAsPNG();
    });

    document.getElementById('btnReset').addEventListener('click', ()=>{
      infoPanel.classList.add('hidden');
      if(animFrame) cancelAnimationFrame(animFrame);
      animFrame = null;
      shuttleEl.setAttribute('cx', campusData['KampusKesehatan'].coords.x);
      shuttleEl.setAttribute('cy', campusData['KampusKesehatan'].coords.y);
      // ensure routes shown
      [routeKKU, routeKSU, routeKVU].forEach(r => { if(r) r.style.display = ''; });
      routesVisible = true;
      btnToggle.textContent = 'Sembunyikan Rute';
    });

    // Simple PDF export: convert PNG then open in new tab for printing as PDF
    document.getElementById('btnDownloadPDF').addEventListener('click', async ()=>{
      await exportSVGAsPNG(true);
    });

    // Export helper
    function exportSVGAsPNG(openForPrint=false){
      return new Promise((resolve, reject)=>{
        const svgEl = document.getElementById('svgMap');
        const serializer = new XMLSerializer();
        let svgStr = serializer.serializeToString(svgEl);

        // add computed style so fonts render
        const css = Array.from(document.styleSheets).reduce((acc, sheet) => {
          try{
            const rules = sheet.cssRules;
            if(!rules) return acc;
            return acc + Array.from(rules).map(r => r.cssText).join(' ');
          }catch(e){
            return acc;
          }
        }, '');

        svgStr = '<svg xmlns="http://www.w3.org/2000/svg" width="' + svgEl.getAttribute('width') + '" height="' + svgEl.getAttribute('height') + '" viewBox="' + svgEl.getAttribute('viewBox') + '">' + svgStr + '</svg>';

        const svgBlob = new Blob([serializer.serializeToString(svgEl)], {type: 'image/svg+xml;charset=utf-8'});
        const url = URL.createObjectURL(svgBlob);
        const img = new Image();

        // handle cross-origin fonts: load as same origin (we used Google Fonts, may be blocked in some contexts)
        img.onload = function(){
          const canvas = document.createElement('canvas');
          const rect = svgEl.getBoundingClientRect();
          // hi-res export
          const scale = 2;
          canvas.width = Math.max(800, rect.width * scale);
          canvas.height = Math.max(600, rect.height * scale);
          const ctx = canvas.getContext('2d');
          ctx.fillStyle = '#ffffff';
          ctx.fillRect(0,0,canvas.width,canvas.height);
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          URL.revokeObjectURL(url);
          const png = canvas.toDataURL('image/png');

          // download or open
          if(openForPrint){
            const w = window.open('', '_blank');
            if(!w) {
              // fallback: force download
              const a = document.createElement('a'); a.href = png; a.download = 'Peta_Kampus_Seruni.png'; a.click();
              resolve(true);
            } else {
              w.document.write('<img src="' + png + '" style="max-width:100%;display:block;margin:0 auto"/>');
              w.document.title = 'Peta Kampus — Export';
              w.document.close();
              resolve(true);
            }
          } else {
            const a = document.createElement('a'); a.href = png; a.download = 'Peta_Kampus_Seruni.png'; a.click();
            resolve(true);
          }
        };

        img.onerror = function(err){
          // fallback: try to open svg data directly
          const a = document.createElement('a');
          a.href = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(serializer.serializeToString(svgEl));
          a.download = 'Peta_Kampus_Seruni.svg';
          a.click();
          resolve(false);
        };

        img.src = url;
      });
    }

    // Small help modal (simple)
    document.getElementById('btnHelp').addEventListener('click', ()=>{
      alert('Petunjuk singkat:\\n- Klik salah satu kampus untuk membuka panel info.\\n- Gunakan tombol Rute untuk sembunyikan/tampilkan rute.\\n- Mulai/Stop shuttle untuk melihat animasi pergerakan shuttle menuju Kampus Utama.\\n- Export PNG untuk menyimpan peta.');
    });

    // Initial placement of shuttle on Kampus Kesehatan
    shuttleEl.setAttribute('cx', campusData['KampusKesehatan'].coords.x);
    shuttleEl.setAttribute('cy', campusData['KampusKesehatan'].coords.y);

    // Accessibility: keyboard navigation for campus items
    document.querySelectorAll('.campus-item').forEach((el)=>{ el.tabIndex = 0; });

    // Ensure screen-reader announce after panel opens
    const observer = new MutationObserver(()=>{ /* placeholder for ARIA updates if needed */ });
    observer.observe(infoPanel, {attributes:true,attributeFilter:['class']});

    // End script
  </script>
</body>
</html>
